{"ast":null,"code":"import _regeneratorRuntime from \"/Users/jiasheng/Documents/GitHub/tbj/node_modules/next/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"/Users/jiasheng/Documents/GitHub/tbj/node_modules/next/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport { isomorphicUnfetchData } from '../utils/api';\nimport Router from \"next/router\";\nexport var handleSignOut = /*#__PURE__*/function () {\n  var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(e) {\n    return _regeneratorRuntime.wrap(function _callee$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            e.preventDefault();\n            _context.next = 3;\n            return isomorphicUnfetchData({\n              route: 'api/signout',\n              method: 'POST',\n              body: {\n                name: 123\n              }\n            });\n\n          case 3:\n            Router.push('/');\n\n          case 4:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, _callee);\n  }));\n\n  return function handleSignOut(_x) {\n    return _ref.apply(this, arguments);\n  };\n}();\nexport var handleSignIn = /*#__PURE__*/function () {\n  var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2(e) {\n    return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n      while (1) {\n        switch (_context2.prev = _context2.next) {\n          case 0:\n            e.preventDefault();\n            _context2.next = 3;\n            return isomorphicUnfetchData({\n              route: 'api/signin',\n              method: 'POST',\n              body: {\n                name: 123\n              }\n            });\n\n          case 3:\n          case \"end\":\n            return _context2.stop();\n        }\n      }\n    }, _callee2);\n  }));\n\n  return function handleSignIn(_x2) {\n    return _ref2.apply(this, arguments);\n  };\n}();\nexport var redirectOnAuthError = function redirectOnAuthError(res) {\n  if (true) {\n    Router.push(\"/account/signin\");\n    return {};\n  } else {\n    res.writeHead(302, {\n      Location: '/account/signin'\n    });\n    res.end();\n    return {};\n  }\n};\nexport var checkAuthReturnData = /*#__PURE__*/function () {\n  var _ref4 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee3(_ref3) {\n    var api_res, res, json;\n    return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n      while (1) {\n        switch (_context3.prev = _context3.next) {\n          case 0:\n            api_res = _ref3.api_res, res = _ref3.res;\n\n            if (!api_res.ok) {\n              _context3.next = 8;\n              break;\n            }\n\n            _context3.next = 4;\n            return api_res.json();\n\n          case 4:\n            json = _context3.sent;\n            return _context3.abrupt(\"return\", json);\n\n          case 8:\n            return _context3.abrupt(\"return\", redirectOnAuthError(res));\n\n          case 9:\n          case \"end\":\n            return _context3.stop();\n        }\n      }\n    }, _callee3);\n  }));\n\n  return function checkAuthReturnData(_x3) {\n    return _ref4.apply(this, arguments);\n  };\n}();","map":{"version":3,"sources":["/Users/jiasheng/Documents/GitHub/tbj/src/services/auth.js"],"names":["isomorphicUnfetchData","Router","handleSignOut","e","preventDefault","route","method","body","name","push","handleSignIn","redirectOnAuthError","res","writeHead","Location","end","checkAuthReturnData","api_res","ok","json"],"mappings":";;AAAA,SAASA,qBAAT,QAAsC,cAAtC;AAEA,OAAOC,MAAP,MAAmB,aAAnB;AAEA,OAAO,IAAMC,aAAa;AAAA,sEAAG,iBAAMC,CAAN;AAAA;AAAA;AAAA;AAAA;AAC3BA,YAAAA,CAAC,CAACC,cAAF;AAD2B;AAAA,mBAErBJ,qBAAqB,CAAC;AAAEK,cAAAA,KAAK,EAAE,aAAT;AAAwBC,cAAAA,MAAM,EAAE,MAAhC;AAAwCC,cAAAA,IAAI,EAAE;AAAEC,gBAAAA,IAAI,EAAE;AAAR;AAA9C,aAAD,CAFA;;AAAA;AAG3BP,YAAAA,MAAM,CAACQ,IAAP,CAAY,GAAZ;;AAH2B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAAH;;AAAA,kBAAbP,aAAa;AAAA;AAAA;AAAA,GAAnB;AAMP,OAAO,IAAMQ,YAAY;AAAA,uEAAG,kBAAMP,CAAN;AAAA;AAAA;AAAA;AAAA;AAC1BA,YAAAA,CAAC,CAACC,cAAF;AAD0B;AAAA,mBAEpBJ,qBAAqB,CAAC;AAAEK,cAAAA,KAAK,EAAE,YAAT;AAAuBC,cAAAA,MAAM,EAAE,MAA/B;AAAuCC,cAAAA,IAAI,EAAE;AAAEC,gBAAAA,IAAI,EAAE;AAAR;AAA7C,aAAD,CAFD;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAAH;;AAAA,kBAAZE,YAAY;AAAA;AAAA;AAAA,GAAlB;AAKP,OAAO,IAAMC,mBAAmB,GAAG,SAAtBA,mBAAsB,CAACC,GAAD,EAAS;AAC1C,YAAmC;AACjCX,IAAAA,MAAM,CAACQ,IAAP,CAAY,iBAAZ;AACA,WAAO,EAAP;AACD,GAHD,MAGO;AACLG,IAAAA,GAAG,CAACC,SAAJ,CAAc,GAAd,EAAmB;AAAEC,MAAAA,QAAQ,EAAE;AAAZ,KAAnB;AACAF,IAAAA,GAAG,CAACG,GAAJ;AACA,WAAO,EAAP;AACD;AACF,CATM;AAWP,OAAO,IAAMC,mBAAmB;AAAA,uEAAG;AAAA;AAAA;AAAA;AAAA;AAAA;AAAQC,YAAAA,OAAR,SAAQA,OAAR,EAAiBL,GAAjB,SAAiBA,GAAjB;;AAAA,iBAC7BK,OAAO,CAACC,EADqB;AAAA;AAAA;AAAA;;AAAA;AAAA,mBAEZD,OAAO,CAACE,IAAR,EAFY;;AAAA;AAEzBA,YAAAA,IAFyB;AAAA,8CAIxBA,IAJwB;;AAAA;AAAA,8CAOxBR,mBAAmB,CAACC,GAAD,CAPK;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAAH;;AAAA,kBAAnBI,mBAAmB;AAAA;AAAA;AAAA,GAAzB","sourcesContent":["import { isomorphicUnfetchData } from '../utils/api';\n\nimport Router from \"next/router\";\n\nexport const handleSignOut = async e => {\n  e.preventDefault();\n  await isomorphicUnfetchData({ route: 'api/signout', method: 'POST', body: { name: 123 }});\n  Router.push('/');\n};\n\nexport const handleSignIn = async e => {\n  e.preventDefault();\n  await isomorphicUnfetchData({ route: 'api/signin', method: 'POST', body: { name: 123 }});\n};\n\nexport const redirectOnAuthError = (res) => {\n  if (typeof window !== \"undefined\") {\n    Router.push(\"/account/signin\");\n    return {}\n  } else {\n    res.writeHead(302, { Location: '/account/signin' })\n    res.end();\n    return {}\n  }\n};\n\nexport const checkAuthReturnData = async ({api_res, res}) => {\n  if (api_res.ok) {\n    const json = await api_res.json();\n    //get and save user info on redux\n    return json;\n  } else {\n    // https://github.com/developit/unfetch#caveats\n    return redirectOnAuthError(res);\n  }\n}\n"]},"metadata":{},"sourceType":"module"}